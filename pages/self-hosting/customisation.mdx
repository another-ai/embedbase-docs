
### Customization

#### Authentication

Right now, we just support simple firebase auth. We'll be adding more integrations as we go.

`config.yaml`
```yaml
auth: firebase
# make sure to have "service_account.json" at this path
firebase_service_account_path: ./service_account.json
```

[Get an **ID token** from your client](https://firebase.google.com/docs/auth/admin/verify-id-tokens#retrieve_id_tokens_on_clients)

```bash
TOKEN="foo"
const VAULT_ID = "people"
curl -X POST -H "Authorization: Bearer $TOKEN" -H "Content-Type: application/json" -d '{"query": "Bob"}' http://localhost:8080/v1/${VAULT_ID}/search | jq '.'
```

You can only get ID tokens through Firebase client SDK, there is [an example to use authentication with React](https://github.com/another-ai/embedbase/tree/main/examples/simple-react-auth).

#### Observability

You can use [sentry](https://sentry.io/welcome/) for error reporting. You can set your own sentry config in `config.yaml`

`config.yaml`
```yaml
sentry: YOUR_DSN
```

#### Custom database

You need to implement the abstract class `VectorDatabase` found [here](https://github.com/different-ai/embedbase/blob/main/embedbase/db.py) and then use it like:

```py
from embedbase import get_app

from embedbase.settings import Settings
from embedbase.supabase_db import Supabase

from .my_custom_db import MyCustomDb

settings = Settings(
    # your config goes here, or use "get_settings" helper to use a config.yaml
)

app = (
    get_app(settings)
    .use(MyCustomDb())
).run()
```


#### Custom middleware

Example production middlewares:

- Playground Embedbase instance is [open source](https://github.com/another-ai/embedbase-hosted)

You can a custom middleware like this:

```py
from embedbase import get_app

from embedbase.settings import Settings
from embedbase.supabase_db import Supabase

settings = Settings(
    # your config goes here, or use "get_settings" helper to use a config.yaml
)

async def process_time(request, call_next):
    start_time = time.time()
    response = await call_next(request)
    process_time = time.time() - start_time
    response.headers["X-Process-Time"] = str(process_time)
    
    return response

app = (
    get_app(settings)
    .use(process_time)
    # we use supabase.com as db
    .use(Supabase(settings.supabase_url, settings.supabase_key))
).run()

```

```bash
curl -X POST -H "Content-Type: application/json" -d '{"query": "Bob"}' http://localhost:8080/v1/people/search | jq '.'
```

```json
{
  "query": "Bob",
  "similarities": [
    {
      "score": 0.828773,
      "id": "ABCU75FEBE",
      "data": "Elon is sipping a tea on Mars",
    }
  ],
  "headers": {
    "x-process-time": "0.0001239776611328125"
  }
}
```
